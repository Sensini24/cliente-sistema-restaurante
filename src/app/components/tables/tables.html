<div class="container">
  <header class="page-header">
    <h1>Mesas</h1>
    <p class="subtitle">
      Selecciona una mesa para iniciar o continuar un pedido.
    </p>
  </header>

  <div class="main-content">
    <div class="section-header">
      <h2>Estado de mesas</h2>
      <div class="filters">
        <label class="filter-option">
          <input type="radio" name="filter" value="all" checked />
          <span>Todas</span>
        </label>
        <label class="filter-option">
          <input type="radio" name="filter" value="libre" />
          <span>Libre</span>
        </label>
        <label class="filter-option">
          <input type="radio" name="filter" value="ocupada" />
          <span>Ocupada</span>
        </label>
        <label class="filter-option">
          <input type="radio" name="filter" value="limpieza" />
          <span>En limpieza</span>
        </label>
      </div>
    </div>

    <div class="mesas-grid">
      @for (table of tables$ | async; track table.id) {
        @if (table.estado == "Libre") {
          <div class="mesa-card libre" (click)="showMesaOptions(table)">
            <div class="mesa-number">{{ table.numero }}</div>
            <div class="mesa-status">{{ table.estado }}</div>
          </div>
        } @else if (table.estado == "Ocupada") {
          <div class="mesa-card ocupada" (click)="showMesaOptions(table)">
            <div class="mesa-number">{{ table.numero }}</div>
            <div class="mesa-status">{{ table.estado }}</div>
          </div>
        } @else if (table.estado == "En Limpieza") {
          <div class="mesa-card limpieza" (click)="showMesaOptions(table)">
            <div class="mesa-number">{{ table.numero }}</div>
            <div class="mesa-status">{{ table.estado }}</div>
          </div>
        }
      }

      <!-- Modal de opciones para mesa libre -->
      <div
        class="modal-overlay"
        [style.display]="stateFreeTable ? 'flex' : 'none'"
        id="modal-mesa-libre"
        *ngIf="showModal"
      >
        <div class="modal">
          <div class="modal-header">
            <h3>Mesa <span id="mesa-libre-number">{{ table.numero }}</span></h3>
            <button class="modal-close" (click)="closeModalOptions()">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div class="option-list">
              <button
                class="option-item"
                (click)="SendInfoTableToMakesOrder()"
              >
                <span class="option-icon">‚ûï</span>
                <span>Crear nuevo pedido</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de opciones para mesa ocupada -->
      <div
  class="modal-overlay"
  id="modal-mesa-ocupada"
  *ngIf="showModal"
  [style.display]="stateOccupiedTable ? 'flex' : 'none'"
>
  <div class="modal">
    @let order = orderDetails$ | async;

    <div class="modal-header">
      <h3>Mesa <span id="mesa-ocupada-number">{{ table.numero }}</span></h3>
      <button class="modal-close" (click)="closeModalOptions()">
        &times;
      </button>
    </div>
    <div class="modal-body">
      <div class="pedido-info">
        <div class="info-row">
          <span class="label">Hora inicio:</span>
          <span class="value" id="pedido-hora">
            {{ order?.fechahora | date: "hh:mm a" }}
          </span>
        </div>
        <div class="info-row">
          <span class="label">Items:</span>
          <span class="value" id="pedido-items">{{order?.itempedidos?.length}} items</span>
        </div>
        <div class="info-row">
          <span class="label">Total:</span>
          <span class="value" id="pedido-total">${{order?.total}}</span>
        </div>
      </div>
      <div class="option-list">
        <button class="option-item">
          <span class="option-icon">üëÅÔ∏è</span>
          <span>Ver detalle del pedido</span>
        </button>
        <button class="option-item" (click)="SendInfoOrderToUpdateOrder(order?.id ?? 0)">
          <span class="option-icon">‚ûï</span>
          <span>Agregar items</span>
        </button>
        <button class="option-item">
          <span class="option-icon">‚úÖ</span>
          <span>Finalizar pedido</span>
        </button>
        <button class="option-item">
          <span class="option-icon">üí∞</span>
          <span>Cobrar pedido</span>
        </button>
      </div>
    </div>
  </div>
</div>
      <!-- Modal de opciones para mesa en limpieza -->
      <div
        class="modal-overlay"
        [style.display]="stateCleaningTable ? 'flex' : 'none'"
        id="modal-mesa-limpieza"
        *ngIf="showModal"
      >
        <div class="modal">
          <div class="modal-header">
            <h3>Mesa <span id="mesa-limpieza-number">{{ table.numero }}</span></h3>
            <button class="modal-close" (click)="closeModalOptions()">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div class="option-list">
              <button class="option-item" (click)="changeToFreeStateTable()">
                <span class="option-icon">‚ú®</span>
                <span>Marcar como libre</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de confirmaci√≥n -->
      <div
        class="modal-overlay"
        [style.display]="confirmation ? 'flex' : 'none'"
        *ngIf="showModal"
        id="modal-confirmacion"
      >
        <div class="modal modal-small">
          <div class="modal-header">
            <h3>Confirmar acci√≥n</h3>
          </div>
          <div class="modal-body">
            <p id="mensaje-confirmacion">
              ¬øEst√°s seguro de realizar esta acci√≥n?
            </p>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary">Cancelar</button>
            <button class="btn-primary" id="btn-confirmar">Confirmar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
